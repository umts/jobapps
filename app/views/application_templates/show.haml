- if @current_user.try :staff?
  .container
    - if @template.active?
      .row.note_item
        .col-md-6
          This application is available to applicants. Not hiring currently?
          Click here to deactivate the application:
        .cold-md-6
          = button_to 'Deactivate application',
              toggle_active_application_url(@template), class: 'btn btn-default'
    - else
      .row.note_item
        This application is currently not available to applicants. Hiring
        again? Click here to reactivate the application:
        .cold-md-6
          = button_to 'Activate application',
              toggle_active_application_url(@template), class: 'btn btn-default'

- if @current_user.try(:staff?) || @template.active?
  .form
    %h1.title Application for #{@template.position.name_and_department}
    -if @template.email.present? && @current_user.try(:staff?)
      %div
        Reply-to email:
        = @template.email
    %strong
      Fields marked with an asterisk (
      %span.ast *
      ) are required.
    - if should_allow_form_refilling? && @old_applications.present?
      .row#old_application_block
        .col-md-8.col-md-offset-2#subtitle
          You have some old applications you can take responses from!
        %table.col-md-8.col-md-offset-2
          %tr
            %th
              Submitted
          - @old_applications.each do |app|
            %tr
              %td
                = format_date_time app.created_at
              %td.load_column
                = link_to 'Load reponses', application_path(@template, load_id: app.id)
    = form_tag controller: :application_submissions, action: :create do
      = fields_for :user do |u|
        .field
          .heading Please complete the following personal information.
          .explanation You will be able to log in and review your application.
        .field
            .row
              .col-md-6
                .label= u.label :first_name
              .col-md-6
                = u.text_field :first_name, size: 50, required: true,
                  value: @current_user.try(:first_name)
                %span.ast *
        .field
            .row
              .col-md-6
                .label= u.label :last_name
              .col-md-6
                = u.text_field :last_name, size: 50, required: true,
                  value: @current_user.try(:last_name)
                %span.ast *
        .field
            .row
              .col-md-6
                .label= u.label :email
              .col-md-6
                = u.email_field field, size: 50, required: true,
                    value: @current_user.try(:email)
                %span.ast *
      = fields_for :data do |r|
        - @template.questions.each do |question|
          .field
            - if question.explanation?
              .explanation= render_markdown question.prompt
            - elsif question.heading?
              %h3.heading
                = question.prompt
            - else
              .form-group.row
                .col-md-6
                  .label= r.label question.prompt, question.prompt
                .col-md-6
                  - case question.data_type
                  - when 'phone-number'
                    = r.text_field question.unique_name, required: question.required?,
                      class: 'phone', size: 20, placeholder: '(XXX) XXX-XXXX',
                      value: @old_data[question.id] || ""
                  - when 'long-text'
                    = r.text_area question.unique_name,
                      required: question.required?,
                      size: '50x5',
                      value: @old_data[question.id] || ""
                  - when 'text'
                    = r.text_field question.unique_name,
                      required: question.required?,
                      size: 50,
                      value: @old_data[question.id] || ""
                  - when 'date'
                    .form-group.row
                      = r.text_field question.unique_name,
                        required: question.required?,
                        class: 'datepicker',
                        placeholder: 'Click here to select date...',
                        size: 40,
                        value: @old_data[question.id] || ""
                  - when 'number'
                    = r.number_field question.unique_name,
                      required: question.required?,
                      value: (@old_data[question.id] || "").to_i
                  - when 'yes/no'
                    Yes
                    = r.radio_button question.unique_name, 'Yes',
                      required: question.required?,
                      checked: @old_data[question.id] == 'Yes'
                    No
                    = r.radio_button question.unique_name, 'No',
                      required: question.required?,
                      checked: @old_data[question.id] == 'No'
                  - if question.required?
                    %span.ast *
            = r.hidden_field question.unique_prompt_name,
              value: question.prompt
            = r.hidden_field question.unique_data_type_name,
              value: question.data_type
            = r.hidden_field question.id,
              value: "#{question.id}-#{question.number}"
      = hidden_field_tag :position_id, @template.position_id

      - if @template.unavailability_enabled?
        .heading Unavailability
        .explanation
          Please fill out your weekly unavailability for this semester via this calendar. This is
          used to determine if you have enough available time to commit to this position.
          Check off times when you are
          %strong not
          available to work.
          Note that you can click and drag to check or uncheck a range of boxes.
        %br
        = fields_for :unavailability do |u|
          =render partial: "application_drafts/unavailabilities_calendar",
                locals: { form: u }

      - if @template.eeo_enabled?
        .heading Voluntary Equal Employment Opportunity Information
        .explanation
          The University of Massachusetts and the Pioneer Valley
          Transit Authority are equal opportunity employers. To help
          us insure that we are complying with EEO policies, please supply
          the information requested below.
        .field
          .label
            Please select the ethnic group with which you most closely identify:
        .field
          = select_tag :ethnicity,
            options_for_select(ApplicationSubmission::ETHNICITY_OPTIONS),
            include_blank: 'Prefer not to answer'
        .field
          .label Please select the gender with which you most closely identify:
        .field
          = select_tag :gender,
            options_for_select(ApplicationSubmission::GENDER_OPTIONS),
            include_blank: 'Prefer not to answer'

      .centered= submit_tag 'Submit application', class: 'btn btn-primary' unless @current_user.try(:staff?)
- else
  .note_item= @template.position.not_hiring_text
